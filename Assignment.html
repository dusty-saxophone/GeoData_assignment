<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Assignment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Assignment_files/libs/clipboard/clipboard.min.js"></script>
<script src="Assignment_files/libs/quarto-html/quarto.js"></script>
<script src="Assignment_files/libs/quarto-html/popper.min.js"></script>
<script src="Assignment_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Assignment_files/libs/quarto-html/anchor.min.js"></script>
<link href="Assignment_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Assignment_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Assignment_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Assignment_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Assignment_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="computing-assignment-geo-data-and-methods-in-r" class="level1">
<h1>Computing Assignment: Geo-data and Methods in R</h1>
<p>Link to anonymous GitHub repository: <a href="https://github.com/dusty-saxophone/GeoData_assignment" class="uri">https://github.com/dusty-saxophone/GeoData_assignment</a></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>A symbiosis is a close and long term interaction between two different species. There are several different types of symbiotic interactions which are categorised based on fitness benefits to each of the species - positive effect, no effect, or negative effect. By studying species overlaps, information can be gained about the strength of interspecific symbiotic interactions and may facilitate the identification of habitats critical to both species and aid conservation efforts. In this assignment, species ranges will be predicted by a model using known species locality data from the Global Biodiversity Information Facility, GBIF (<a href="https://www.gbif.org" class="uri">https://www.gbif.org</a>), and environmental data from Worldclim (<a href="#0">https://www.worldclim.org</a>). By selecting the bioclimatic variables which best explain the species locality data, they can be used to predict a species presence or absence in a different location. In addition, by using models which predict how bioclimatic variables will change in the future, future species distributions and overlaps can also be predicted. The model which will be used is the Coupled Model Intercomparison Project Phase 5 (CMIP5) for the years 2061-2080.</p>
<p>The two species I will be looking at are the puma (<em>Puma concolor</em>) and the moose (<em>Alces alces</em>). Pumas are known predators of moose, preferring to feed on large mammals including moose, mule deer, and white-tailed deer. In 2017, only two subspecies of cougar were considered to be valid by the IUCN Cat Specialist Group, the North American Puma (<em>P. concolor couguar</em>) and the South American Puma (<em>P. concolor concolor</em>). I will be focusing on the North American subspecies and will be limiting my distributions to the USA and Canada where cougars and moose are both present.</p>
</section>
<section id="species-1-distribution-modelling---puma-concolor" class="level2">
<h2 class="anchored" data-anchor-id="species-1-distribution-modelling---puma-concolor">1. Species 1 Distribution Modelling - Puma concolor</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># Manages file paths relative to project directory</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dismo) <span class="co"># Functions for modelling species distribution </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rworldmap) <span class="co"># World map</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># Used for spatial data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodata) <span class="co"># Functions for downloading geographic data for use in spatial analysis. including climate data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain a low resolution world map</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>wrld_simpl <span class="ot">&lt;-</span> <span class="fu">getMap</span>(<span class="at">resolution =</span> <span class="st">"coarse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="function-to-access-species-records-from-gbif" class="level4">
<h4 class="anchored" data-anchor-id="function-to-access-species-records-from-gbif">1.1 Function to access species records from GBIF</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Function which gets species data from GBIF</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param genus genus name of species to obtain gbif spatial data for</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param species species name of species to obtain gbif spatial data for</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return saves and reads gbif file</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>get_species_gbif <span class="ot">&lt;-</span> <span class="cf">function</span>(genus, species) {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Genus and species in single string separated by underscore</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  species_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(genus, species, <span class="at">sep =</span> <span class="st">"_"</span>) </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save in project directory using the species name</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  species.gbif_file <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="fu">paste0</span>(species_name,<span class="st">".gbif.rds"</span>))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If the file does not exist fetch data using gbif</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If the file already exists read it</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(species.gbif_file)) {</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  species.gbif <span class="ot">&lt;-</span> <span class="fu">gbif</span>(genus, species, <span class="at">geo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(species.gbif, species.gbif_file)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  species.gbif <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(species.gbif_file)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the data from the file so it can be stored as a dataframe</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(species.gbif)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Using function above to obtain puma data</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>species1_gbif <span class="ot">&lt;-</span> <span class="fu">get_species_gbif</span>(<span class="st">"puma"</span>, <span class="st">"concolor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="function-to-pull-out-latitude-and-longitude-data" class="level4">
<h4 class="anchored" data-anchor-id="function-to-pull-out-latitude-and-longitude-data">1.2 Function to pull out latitude and longitude data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Function to obtain lat and lon data from species gbif</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data species gbif data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return returns latitude and longitude coordinates</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>get_species_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add latitude and longitude data to dataframe and omit any NAs</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  species_coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data<span class="sc">$</span>lon, data<span class="sc">$</span>lat) <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(species_coords) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(species_coords)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Using function above to obtain species coordinates</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>species1_coords <span class="ot">&lt;-</span> <span class="fu">get_species_coords</span>(species1_gbif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="function-to-filter-spatial-data-within-specified-latitude-and-longitude" class="level4">
<h4 class="anchored" data-anchor-id="function-to-filter-spatial-data-within-specified-latitude-and-longitude">1.3 Function to filter spatial data within specified latitude and longitude</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Function to trim coordinates within specified latitude and longitude</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data dataframe containing species coordinates</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param latmin minimum latitude value</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param latmax maximum latitude value</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param lonmim minimum longitude value</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param lonmax maximum longitude value</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return trimmed coordinates within the specified boundaries</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>trim_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(data, latmin, latmax, lonmin, lonmax) {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  data[data<span class="sc">$</span>lon <span class="sc">&gt;=</span> lonmin <span class="sc">&amp;</span> data<span class="sc">$</span>lon <span class="sc">&lt;=</span> lonmax <span class="sc">&amp;</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>         data<span class="sc">$</span>lat <span class="sc">&gt;=</span> latmin <span class="sc">&amp;</span> data<span class="sc">$</span>lat <span class="sc">&lt;=</span> latmax, ]</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Use function above to trim data:</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>species1_coords_trim <span class="ot">&lt;-</span> <span class="fu">trim_coords</span>(species1_coords,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latmin =</span> <span class="dv">24</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latmax =</span> <span class="dv">84</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lonmin =</span> <span class="sc">-</span><span class="dv">141</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lonmax =</span> <span class="sc">-</span><span class="dv">64</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot trimmed data:</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(wrld_simpl, </span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>     <span class="co">#xlim = range(species1_coords_trim$lon),</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>     <span class="co">#ylim = range(species1_coords_trim$lat),</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>     <span class="co">#axes = TRUE,</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>     <span class="co">#col = "light yellow")</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># points(species1_coords_trim, col = "red", cex = 0.4)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-species-current-distribution-based-on-climatic-variables" class="level4">
<h4 class="anchored" data-anchor-id="model-species-current-distribution-based-on-climatic-variables">1.4 Model species current distribution based on climatic variables</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the bioclimatic data from the WorldClim database and name the 19 bioclimatic variables</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>bio.data <span class="ot">&lt;-</span> <span class="fu">worldclim_global</span>(<span class="at">var =</span> <span class="st">"bio"</span>, <span class="at">res =</span> <span class="dv">10</span>, <span class="at">path =</span> <span class="fu">here</span>())</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bio.data) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"bio"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the study extent for species 1 with a buffer of +/- 5 degrees</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>study_extent <span class="ot">&lt;-</span> <span class="fu">extent</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(species1_coords_trim<span class="sc">$</span>lon) <span class="sc">-</span> <span class="dv">5</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(species1_coords_trim<span class="sc">$</span>lon) <span class="sc">+</span> <span class="dv">5</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(species1_coords_trim<span class="sc">$</span>lat) <span class="sc">-</span> <span class="dv">5</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(species1_coords_trim<span class="sc">$</span>lat) <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mask from the world map for the study region, essentially filtering the map </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(wrld_simpl, <span class="fu">raster</span>(study_extent, <span class="at">res=</span><span class="fl">0.5</span>))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 500 random background coordinates within the study region</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>bg <span class="ot">&lt;-</span> <span class="fu">randomPoints</span>(mask, <span class="dv">500</span>, <span class="at">ext=</span>study_extent)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(bg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine presence and background coordinates into a dataframe</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">rbind</span>(species1_coords_trim, bg)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of 1s and 0s to indicate presence/absence for training data</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates where species is present (p) are assigned "1"</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates where species is absent are (b) assigned "0"</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>pb_train <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(species1_coords_trim)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bg)))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the bioclimatic data for the presence and background points</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract function obtains climate data for each coordinate in the training dataset</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the presence and absence labels from with the climate data for each coordinate</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>species1_envtrain <span class="ot">&lt;-</span> <span class="fu">extract</span>(bio.data, train)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>species1_envtrain <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="at">pa =</span> pb_train, species1_envtrain))</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>species1_envtrain <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(species1_envtrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="function-to-compare-which-set-of-climatic-variables-best-explain-the-data" class="level4">
<h4 class="anchored" data-anchor-id="function-to-compare-which-set-of-climatic-variables-best-explain-the-data">1.5 Function to compare which set of climatic variables best explain the data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Function which generates every possible glm using specified bioclimatic variables with the aim of establishing which model (and therefore variables) best explains the presence and absence data for a species. The Akaike information criterion (AIC) is calculated for each model and is used as the indicator for the quality of the model. AIC values are compared and the lowest value and its model is outputted.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data dataframe containing presence and absence data, and bioclimatic data</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param response_variable presence/absence data from dataframe which changes in response to bioclimatic variables</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param climatic_variables selection of the 19 climatic variables chosen to explain p/a</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return the combination of bioclimatic variables which generates the best fitting model with the lowest AIC</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>compare_bioclim_models <span class="ot">&lt;-</span> <span class="cf">function</span>(data, response_variable, climatic_variables) {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a list to store AIC values for each model</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  model_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop through all possible combinations of bioclimatic variables</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(climatic_variables)) {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate all possible combinations of climatic variables and return as list</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    possible_combinations <span class="ot">&lt;-</span> <span class="fu">combn</span>(climatic_variables, i, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each combination stored in the list</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (combination <span class="cf">in</span> possible_combinations) {</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Build the formula for the linear model using each combination</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Concatenate each variable with a "+" between</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(response_variable, <span class="st">"~"</span>, <span class="fu">paste</span>(combination, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Fit the model using the dataframe specified</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      model <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> data)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Store the model and AIC value in the list created earlier</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      model_results[[<span class="fu">paste</span>(combination, <span class="at">collapse =</span> <span class="st">" + "</span>)]] <span class="ot">&lt;-</span> <span class="fu">AIC</span>(model)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert results to a data frame</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  model_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">names</span>(model_results),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">aic =</span> <span class="fu">unlist</span>(model_results),</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the best model (lowest AIC)</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  best_model <span class="ot">&lt;-</span> model_results[<span class="fu">which.min</span>(model_results<span class="sc">$</span>aic), ]</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(best_model)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Define which set of climatic variables should be used by the function to generate the models</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>climatic_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"bio1"</span>, <span class="st">"bio2"</span>, <span class="st">"bio3"</span>, <span class="st">"bio4"</span>, <span class="st">"bio5"</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model comparison function</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">compare_bioclim_models</span>(species1_envtrain, <span class="st">"pa"</span>, climatic_variables)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                              model      aic
bio1 + bio2 + bio4 + bio5 bio1 + bio2 + bio4 + bio5 2350.364</code></pre>
</div>
</div>
</section>
<section id="fit-logistic-regression" class="level4">
<h4 class="anchored" data-anchor-id="fit-logistic-regression">1.6 Fit logistic regression</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run and store the GLM for the combination of climatic variables which best explain the distribution</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>gm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(pa <span class="sc">~</span> bio1 <span class="sc">+</span> bio4 <span class="sc">+</span> bio5,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> species1_envtrain)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio1 + bio4 + bio5, family = binomial(link = "logit"), 
    data = species1_envtrain)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.9334932  0.4696089   6.247 4.19e-10 ***
bio1        -0.6623828  0.0333521 -19.860  &lt; 2e-16 ***
bio4        -0.0153563  0.0005888 -26.079  &lt; 2e-16 ***
bio5         0.6428688  0.0321940  19.969  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3822.4  on 8659  degrees of freedom
Residual deviance: 2346.2  on 8656  degrees of freedom
AIC: 2354.2

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
<section id="predict-species-distribution-from-the-model" class="level4">
<h4 class="anchored" data-anchor-id="predict-species-distribution-from-the-model">1.7 Predict species distribution from the model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the model identified previously, predict the probability of occurrence of the species</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># across the whole of the area being considered</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>pg1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bio.data, gm1, <span class="at">ext =</span> study_extent, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pg1 <span class="ot">&lt;-</span> <span class="fu">crop</span>(pg1, study_extent)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pg is a raster layer representing the probability of occurrence from the selected linear model (gm1), for the area of extent.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot this</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pg1, <span class="at">main =</span> <span class="st">"GLM probability of occurrence of Puma concolor"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add country boundaries</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wrld_simpl, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add observed locality gbif data</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(species1_coords_trim, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph above shows the predicted occurrence of <em>Puma concolor</em> based on the linear model using the selected bioclimatic variables. The probability values of each cell (coordinate) of the raster layer are represented using a colour gradient: high probability of occurrence shown in yellow and low probability of occurrence shown in blue.</p>
<p>To generate this graph, species spatial data was taken from the GBIF database (represented as red points) and environmental data for each cell was obtained from the WorldClim database. The species spatial data and climate data were both filtered (or masked) for the study area of the USA and Canada. A training dataframe was used to generate presence and absence information for the species by combining the spatial data (presence) with random background points (absence), and also the environmental data for each point. The bioclimatic variables which best explain the species spatial data were then selected using the AIC - bio1, bio4, and bio5. This information was then used to train a general linear model to predict the probability of species occurrence, based on the bioclimatic variables selected, at any coordinate with environmental data.</p>
<p>The predicted occurrence data seems quite plausible, with areas of highest probability corresponding with areas containing high densities of species observation points. Furthermore, the textbook Felines of the World (Bellani, 2019) has the contemporary populations of the North American Cougar as Eastern USA, Southeastern Canada, and Florida. It also denotes the rest of the USA and other Southern parts of Canada as regions with severely reduced or extinct populations. Therefore, it is plausible that the climate in Central and Western USA could be suitable for cougar populations and lack of observations in these areas could be due to other factors like incomplete sampling or population reductions caused by anthropogenic activities.</p>
</section>
<section id="using-thresholds" class="level4">
<h4 class="anchored" data-anchor-id="using-thresholds">1.8 Using thresholds</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Can use probability thresholds to generate a single map of distribution. The threshold provides a cutoff which differentiates predicted presence (above threshold) and absence (below threshold)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate how well the model predicts presence/absence at each point</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract bioclimatic data for known presence points</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>species1_testpres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">extract</span>(bio.data, species1_coords_trim))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract bioclimatic data for known absence points</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>species1_testbackg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">extract</span>(bio.data, bg))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate function compares presence/absence data with the models predictions</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>ge1 <span class="ot">&lt;-</span> <span class="fu">evaluate</span>(species1_testpres, species1_testbackg, gm1)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ge1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 8160 
n absences     : 500 
AUC            : 0.8586028 
cor            : 0.5091623 
max TPR+TNR at : 2.435743 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The output gives several metrics such as:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Area Under the Curve: AUC, and correlation coefficient between observed and predicted.</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Higher values of both metrics = better match between model predictions and observed</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># presence/absences.</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the evaluation results to determine an optimal threshold value that best separates predicted presence from absence</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The threshold is based on a chosen method ("prevalence") that minimizes prediction errors</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>tr1 <span class="ot">&lt;-</span> <span class="fu">threshold</span>(ge1, <span class="st">"prevalence"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pg1 <span class="sc">&gt;</span> tr1, <span class="at">main =</span> <span class="st">"Puma presence/absence prediction"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wrld_simpl, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(species1_coords_trim, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This graph shows shows a binary presence/absence for the North American Cougar based on a threshold value from the GLM. The threshold value is generated by the evaluate function which compares presence/absence data with the models predictions. The extent of the species presence matches the textbook extent, and suggests that the rigour provided by the threshold is necessary. However, regions within the extent are showing that the cougar is absent which suggests the model is underperforming. It again backs up the idea that regions shown as absent but contain data points likely contain highly reduced cougar populations.</p>
</section>
</section>
<section id="species-2-distribution-modelling---alces-alces" class="level2">
<h2 class="anchored" data-anchor-id="species-2-distribution-modelling---alces-alces">2. Species 2 Distribution modelling - Alces alces</h2>
<section id="access-species-records-and-filter-data" class="level4">
<h4 class="anchored" data-anchor-id="access-species-records-and-filter-data">2.1 Access species records and filter data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access species records from GBIF</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>species2_gbif <span class="ot">&lt;-</span> <span class="fu">get_species_gbif</span>(<span class="st">"alces"</span>, <span class="st">"alces"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out latitude and longitude data</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>species2_coords <span class="ot">&lt;-</span> <span class="fu">get_species_coords</span>(species2_gbif)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter spatial data within specified latitude and longitude</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>species2_coords_trim <span class="ot">&lt;-</span> <span class="fu">trim_coords</span>(species2_coords,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latmin =</span> <span class="dv">24</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latmax =</span> <span class="dv">84</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lonmin =</span> <span class="sc">-</span><span class="dv">141</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lonmax =</span> <span class="sc">-</span><span class="dv">64</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-species-current-distribution-based-on-climatic-variables-1" class="level4">
<h4 class="anchored" data-anchor-id="model-species-current-distribution-based-on-climatic-variables-1">2.2 Model species current distribution based on climatic variables</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define study extent with buffer</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>study_extent <span class="ot">&lt;-</span> <span class="fu">extent</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(species2_coords_trim<span class="sc">$</span>lon) <span class="sc">-</span> <span class="dv">5</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(species2_coords_trim<span class="sc">$</span>lon) <span class="sc">+</span> <span class="dv">5</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(species2_coords_trim<span class="sc">$</span>lat) <span class="sc">-</span> <span class="dv">5</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(species2_coords_trim<span class="sc">$</span>lat) <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mask from the world map for the study region</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(wrld_simpl, <span class="fu">raster</span>(study_extent, <span class="at">res=</span><span class="fl">0.5</span>))</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate 500 random background points within the study region</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>bg <span class="ot">&lt;-</span> <span class="fu">randomPoints</span>(mask, <span class="dv">500</span>, <span class="at">ext=</span>study_extent)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(bg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine presence and background coordinates into a dataframe</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>species2_train <span class="ot">&lt;-</span> <span class="fu">rbind</span>(species2_coords_trim, bg)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of 1s and 0s to indicate presence/absence for training data</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates where species is present (p) are assigned "1"</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates where species is absent are (b) assigned "0"</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>species2_pb_train <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(species2_coords_trim)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bg)))</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the bioclimatic data for the presence and background points</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract function obtains climate data for each coordinate in the training dataset</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the presence and absence labels from with the climate data for each coordinate</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>species2_envtrain <span class="ot">&lt;-</span> <span class="fu">extract</span>(bio.data, species2_train)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>species2_envtrain <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="at">pa =</span> species2_pb_train, species2_envtrain))</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>species2_envtrain <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(species2_envtrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-which-set-of-climatic-variables-best-explain-the-data" class="level4">
<h4 class="anchored" data-anchor-id="compare-which-set-of-climatic-variables-best-explain-the-data">2.3 Compare which set of climatic variables best explain the data</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model comparison function</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC values are compared and the lowest value and its model is outputted</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> <span class="fu">compare_bioclim_models</span>(species2_envtrain, <span class="st">"pa"</span>, climatic_variables)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                              model      aic
bio2 + bio3 + bio4 + bio5 bio2 + bio3 + bio4 + bio5 3159.551</code></pre>
</div>
</div>
</section>
<section id="fit-logistic-regression-1" class="level4">
<h4 class="anchored" data-anchor-id="fit-logistic-regression-1">2.4 Fit logistic regression</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run and store the GLM for the combination of climatic variables which best explain the distribution</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>gm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(pa <span class="sc">~</span> bio2 <span class="sc">+</span> bio3 <span class="sc">+</span> bio4 <span class="sc">+</span> bio5,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> species2_envtrain)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = pa ~ bio2 + bio3 + bio4 + bio5, family = binomial(link = "logit"), 
    data = species2_envtrain)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) 36.081863   1.618175   22.30   &lt;2e-16 ***
bio2         2.184753   0.108254   20.18   &lt;2e-16 ***
bio3        -0.992530   0.051025  -19.45   &lt;2e-16 ***
bio4        -0.022288   0.001004  -22.19   &lt;2e-16 ***
bio5        -0.260181   0.017106  -15.21   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4035.4  on 10718  degrees of freedom
Residual deviance: 3149.6  on 10714  degrees of freedom
AIC: 3159.6

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
<section id="predict-species-distribution-from-model" class="level4">
<h4 class="anchored" data-anchor-id="predict-species-distribution-from-model">2.5 Predict species distribution from model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the model identified previously, predict the probability of occurrence of the species</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># across the whole of the area being considered</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>pg2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bio.data, gm2, <span class="at">ext =</span> study_extent, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>pg2 <span class="ot">&lt;-</span> <span class="fu">crop</span>(pg2, study_extent)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pg is a raster layer representing the probability of occurrence from the selected linear model (gm2), for the area of extent.</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot this</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pg2, <span class="at">main =</span> <span class="st">"GLM probability of occurrence of Alces alces"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add country boundaries</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wrld_simpl, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add our observed gbif locality data</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(species2_coords_trim, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph above shows the predicted occurrence of <em>Alces alces</em> based on the linear model using the selected bioclimatic variables. The probability values of each cell (coordinate) of the raster layer are represented using a colour gradient: high probability of occurrence shown in yellow and low probability of occurrence shown in blue. The graph was generated using the same methods as for species 1, though used bio2, bio3, bio4, and bio5 variables as predictors.</p>
<p>The predicted occurrence data does not seem plausible for the moose as the predicted range covers a much larger area than the species observation points. It also directly contradicts well established moose range data which has moose limited to Canada, Alaska, and several northern and western US states (Jensen et al, 2018). This suggests that the predictive model is flawed and there could be several reasons for this. Firstly, the bioclimatic variables selected are not the best factor for explaining distribution. Secondly, there are non-climatic factors which are important for limiting moose distribution. Thirdly, the study area was too large and there was too much variation in climate sampled by the background points. Furthermore, there could have been sampling biases within the GBIF dataset which favoured areas populated by humans and missed more remote moose populations.</p>
</section>
<section id="using-thresholds-1" class="level4">
<h4 class="anchored" data-anchor-id="using-thresholds-1">2.6 Using thresholds</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Can use probability thresholds to generate a single map of distribution. The threshold provides a cutoff which differentiates predicted presence (above threshold) and absence (below threshold)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate how well the model predicts presence/absence at each point</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract bioclimatic data for known presence points</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>species2_testpres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">extract</span>(bio.data, species2_coords_trim))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract bioclimatic data for known absence points</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>species2_testbackg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">extract</span>(bio.data, bg))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate function compares presence/absence data with the models predictions</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>ge2 <span class="ot">&lt;-</span> <span class="fu">evaluate</span>(species2_testpres, species2_testbackg, gm2)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ge2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class          : ModelEvaluation 
n presences    : 10221 
n absences     : 500 
AUC            : 0.7898394 
cor            : 0.02936886 
max TPR+TNR at : 2.678318 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The output gives several metrics such as:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Area Under the Curve: AUC, and correlation coefficient between observed and predicted.</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Higher values of both metrics = better match between model predictions and observed</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># presence/absences.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the evaluation results to determine an optimal threshold value that best separates predicted presence from absence</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The threshold is based on a chosen method ("prevalence") that minimizes prediction errors</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>tr2 <span class="ot">&lt;-</span> <span class="fu">threshold</span>(ge2, <span class="st">"prevalence"</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pg2 <span class="sc">&gt;</span> tr2, <span class="at">main =</span> <span class="st">"Moose presence/absence"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wrld_simpl, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(species2_coords_trim, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This graph shows shows a binary presence/absence for the moose based on a threshold value from the GLM. The threshold value is generated by the evaluate function which compares presence/absence data with the models predictions. Similar to the previous model, the presence/absence data is not matching the known species distribution and suggests the model is intrinsically flawed. Furthermore, a possible hypothesis could be that climate change has altered the most suitable areas for moose populations and moose populations have yet to move, or are unable to move, to these areas.</p>
</section>
</section>
<section id="distribution-overlap" class="level2">
<h2 class="anchored" data-anchor-id="distribution-overlap">3. Distribution Overlap</h2>
<p>Plot overlap:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>species1_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(pa <span class="sc">~</span> bio1 <span class="sc">+</span> bio4 <span class="sc">+</span> bio5,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> species1_envtrain)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>species2_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(pa <span class="sc">~</span> bio2 <span class="sc">+</span> bio3 <span class="sc">+</span> bio4 <span class="sc">+</span> bio5,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> species2_envtrain)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define study extent based on coordinates from both species</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>study_extent <span class="ot">&lt;-</span> <span class="fu">extent</span>(<span class="fu">c</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(<span class="fu">c</span>(species2_coords_trim<span class="sc">$</span>lon, species1_coords_trim<span class="sc">$</span>lon)),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(<span class="fu">c</span>(species2_coords_trim<span class="sc">$</span>lon, species1_coords_trim<span class="sc">$</span>lon)),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(<span class="fu">c</span>(species2_coords_trim<span class="sc">$</span>lat, species1_coords_trim<span class="sc">$</span>lat)),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(<span class="fu">c</span>(species2_coords_trim<span class="sc">$</span>lat, species1_coords_trim<span class="sc">$</span>lat))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict species distribution for both species within the study extent</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>species2_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bio.data, species2_glm, <span class="at">ext =</span> study_extent, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>species1_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(bio.data, species1_glm, <span class="at">ext =</span> study_extent, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the predicted distribution (SpatRaster) for each species into RasterLayer format for easier processing</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop to the study extent</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>species2_pred_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(species2_pred)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>species2_pred_raster <span class="ot">&lt;-</span> <span class="fu">crop</span>(species2_pred_raster, study_extent)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>species1_pred_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(species1_pred)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>species1_pred_raster <span class="ot">&lt;-</span> <span class="fu">crop</span>(species1_pred_raster, study_extent)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use overlay function from dismo package</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay function multiplies the probability values from the two rasters together to generate probabilities for overlapping presence</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>overlap <span class="ot">&lt;-</span> <span class="fu">overlay</span>(species2_pred_raster, species1_pred_raster, <span class="at">fun =</span> <span class="cf">function</span>(m, p) m <span class="sc">*</span> p)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot result</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(overlap, <span class="at">main =</span> <span class="st">"Moose &amp; Puma Distribution Overlap"</span>, <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">100</span>))</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wrld_simpl, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above graph shows the possible overlapping distributions of moose and puma. This is achieved my using the models for both species and multiplying the probabilities for each species at each coordinate together to generate probabilities of co-occurrence. High co-occurrence is show in yellow and low co-occurrence is shown in blue. This graph suggests a very high degree in overlap in species occurrence which would support a high degree of interspecific interaction like predation. However, this graph is based on a likely flawed moose distribution and so is probably not indicative of true co-occurrence data.</p>
<p>Quantifying distribution overlap:</p>
<p>The <code>dismo</code> package has a function called nicheOverlap which can compute the degree of species overlap from predictions of species distributions. This is done using two similarity indexes which can quantify the overlap - Schoeners D and Warrens I. Both values are between 0 and 1 and 1 represents complete overlap. The values below suggest that the species have a moderately high degree of niche overlap due to similar environmental requirements but may not be using the same areas equally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Schoener's D</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>niche_overlap_schoener <span class="ot">&lt;-</span> <span class="fu">nicheOverlap</span>(species1_pred_raster, species2_pred_raster, <span class="at">stat =</span> <span class="st">"D"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(niche_overlap_schoener)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5802889</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Warren's I</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>niche_overlap_warren <span class="ot">&lt;-</span> <span class="fu">nicheOverlap</span>(species1_pred_raster, species2_pred_raster, <span class="at">stat =</span> <span class="st">"I"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(niche_overlap_warren)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8363279</code></pre>
</div>
</div>
</section>
<section id="interspecies-distribution-dependence" class="level2">
<h2 class="anchored" data-anchor-id="interspecies-distribution-dependence">4. Interspecies Distribution Dependence</h2>
<p>To test whether the distribution of species 1 depends on the distribution of species 2, whilst also accounting for bioclimatic variables, a linear model must be performed. The model must be trained on a dataset which contains presence data for both species as well as the climate data for each of the points.</p>
<p>The model suggests that there is a strong inverse relationship between the two species (species2_presence estimate is negative, p&lt;2e-16). This is in direct contradiction to the spatial models that suggest overlap. This may be because the linear model makes global predictions based on specific sample points, and there may not have been enough sample points. Also, the use of a linear model makes assumptions about the linearity of the climatic predictors and species presence data. Spatial models are designed to account for heterogeneity and so the previous predictions are more likely to be accurate. In relation to the climatic variables, the model suggests bio2, bio3, bio4, and bio5 have a strong influence on species 1 distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column to the environmental data to identify which species the data is from</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>species2_envtrain<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="st">"species2"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>species1_envtrain<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="st">"species1"</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combined the two environmental training dataframes</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>combined_envtrain <span class="ot">&lt;-</span> <span class="fu">rbind</span>(species2_envtrain, species1_envtrain)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create two new columns based on presence and species</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># This column indicates whether species 2 is present at the point</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># If species 2 is present add 1 to column, else 0</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>combined_envtrain<span class="sc">$</span>species2_presence <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(combined_envtrain<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"species2"</span> <span class="sc">&amp;</span> combined_envtrain<span class="sc">$</span>pa <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># This column indicates whether species 1 is present at the point</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># If species 1 is present add 1 to column, else 0</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>combined_envtrain<span class="sc">$</span>species1_presence <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(combined_envtrain<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"species1"</span> <span class="sc">&amp;</span> combined_envtrain<span class="sc">$</span>pa <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a linear model to investigate the relationship between species presence and environmental variables</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># The model predicts the presence of species 1 based on the presence of species 2 and environmental variables</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>overlap_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(species1_presence <span class="sc">~</span> species2_presence <span class="sc">+</span> bio1 <span class="sc">+</span> bio2 <span class="sc">+</span> bio3 <span class="sc">+</span> bio4 <span class="sc">+</span> bio5, <span class="at">data =</span> combined_envtrain)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(overlap_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = species1_presence ~ species2_presence + bio1 + bio2 + 
    bio3 + bio4 + bio5, data = combined_envtrain)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.14170 -0.04666  0.03117  0.07747  0.45967 

Coefficients:
                    Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)        7.521e-01  3.629e-02   20.725  &lt; 2e-16 ***
species2_presence -6.925e-01  4.049e-03 -171.030  &lt; 2e-16 ***
bio1               2.153e-03  1.361e-03    1.582    0.114    
bio2               1.269e-02  1.755e-03    7.232 4.95e-13 ***
bio3              -8.901e-04  6.969e-04   -1.277    0.202    
bio4              -4.073e-04  2.086e-05  -19.531  &lt; 2e-16 ***
bio5               8.397e-03  1.531e-03    5.484 4.21e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1864 on 19372 degrees of freedom
Multiple R-squared:  0.8576,    Adjusted R-squared:  0.8575 
F-statistic: 1.944e+04 on 6 and 19372 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="future-distribution-prediction" class="level2">
<h2 class="anchored" data-anchor-id="future-distribution-prediction">5. Future Distribution Prediction</h2>
<section id="moose-future-distribution" class="level4">
<h4 class="anchored" data-anchor-id="moose-future-distribution">5.1 Moose future distribution:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download future bioclimatic data from CMIP6 databased</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>future.bio.data <span class="ot">&lt;-</span> <span class="fu">cmip6_world</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"CanESM5"</span>, <span class="co"># Climate model</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"bio"</span>, <span class="co"># Bioclimatic variables</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ssp =</span> <span class="st">"245"</span>, <span class="co"># Emmissions scenario</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">10</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="st">"2061-2080"</span>, <span class="co"># Time period</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">here</span>()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Match the names of the bioclimatic variables</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(future.bio.data) <span class="ot">&lt;-</span> <span class="fu">names</span>(bio.data)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict future distribution for species 2 using the current glm</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>species2_future <span class="ot">&lt;-</span> <span class="fu">predict</span>(future.bio.data, species2_glm, <span class="at">ext =</span> study_extent, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>species2_future <span class="ot">&lt;-</span> <span class="fu">crop</span>(species2_future, study_extent)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(species2_future, <span class="at">main =</span> <span class="st">"GLM probability of future occurrence of Alces alces, 2060-2081"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wrld_simpl, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(species2_coords_trim, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pch =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.5</span>) <span class="co"># Points of current sightings</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph above shows the predicted future occurrence of <em>Alces alces</em> based on the linear model using the selected bioclimatic variables from the <strong>future bioclimatic dataset</strong>. The probability values of each cell (coordinate) of the raster layer are represented using a colour gradient: high probability of occurrence shown in yellow and low probability of occurrence shown in blue. Points of observaations are shown in black,</p>
<p>To generate this graph, future distributions were predicted based on linear models trained on present-day distribution data.</p>
<p>The graph shows changes to the range when compared with the present day occurrence. Future occurrence probabilities are reduced in several areas of the USA, particularly the central region. However, future occurrence probabilities have increased in some regions of northern Canada. This suggests that the climatic variables differ enough in the future to reduce favourability of those areas to the moose.</p>
</section>
<section id="puma-future-distribution" class="level4">
<h4 class="anchored" data-anchor-id="puma-future-distribution">5.2 Puma future distribution:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict future distribution for species 1 using the current glm</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>species1_future <span class="ot">&lt;-</span> <span class="fu">predict</span>(future.bio.data, species1_glm, <span class="at">ext =</span> study_extent, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
|---------|---------|---------|---------|
=========================================
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>species1_future <span class="ot">&lt;-</span> <span class="fu">crop</span>(species1_future, study_extent)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(species1_future, <span class="at">main =</span> <span class="st">"GLM probability of future occurrence of Puma concolor, 2060-2081"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wrld_simpl, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(species1_coords_trim, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pch =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph above shows the predicted future occurrence of <em>Puma concolor</em> based on the linear model using the selected bioclimatic variables from the <strong>future bioclimatic dataset</strong>. The probability values of each cell (coordinate) of the raster layer are represented using a colour gradient: high probability of occurrence shown in yellow and low probability of occurrence shown in blue. Points of observaations are shown in black,</p>
<p>To generate this graph, future distributions were predicted based on linear models trained on present-day distribution data.</p>
<p>The graph shows changes to the range when compared with the present day occurrence. Future occurrence seems to have expanded in some regions in eastern USA and to have contracted slightly in some regions of central USA. These distributions are less pronounced that with the moose. This may be because the cougar is already distributed over an extremely wide range of habitats and so is able to tolerate most changes in climate.</p>
</section>
<section id="future-overlap" class="level4">
<h4 class="anchored" data-anchor-id="future-overlap">5.3 Future overlap:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert SpatRaster to RasterLayer</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>species2_future_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(species2_future)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>species1_future_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(species1_future)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use dismo overlay function to multiply raster probability values</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>future_overlap <span class="ot">&lt;-</span> <span class="fu">overlay</span>(species2_future_raster, species1_future_raster, <span class="at">fun =</span> <span class="cf">function</span>(m, p) m <span class="sc">*</span> p)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot result</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(future_overlap, <span class="at">main =</span> <span class="st">"Moose &amp; Puma Distribution Overlap"</span>, <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">100</span>))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">crop</span>(wrld_simpl, study_extent), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"dark grey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Assignment_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above graph shows the possible overlapping distributions of moose and puma under the future climate change scenario. High co-occurrence is show in yellow and low co-occurrence is shown in blue. This graph suggests a very high degree in overlap in species occurrence which would support a high degree of interspecific interaction like predation. However, this graph is based on a likely flawed moose distribution and so is probably not indicative of true co-occurrence data.</p>
</section>
<section id="quantifying-future-distribution-overlap" class="level4">
<h4 class="anchored" data-anchor-id="quantifying-future-distribution-overlap">5.4 Quantifying future distribution overlap:</h4>
<p>The values below again suggest that the species have a moderately high degree of niche overlap due to similar environmental requirements but may not be using the same areas equally. They are extremely similar to the present day values and suggest the changes in overlap due to climate change are very limited.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Schoener's D</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>future_niche_overlap_schoener <span class="ot">&lt;-</span> <span class="fu">nicheOverlap</span>(species1_future_raster, species2_future_raster, <span class="at">stat =</span> <span class="st">"D"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(future_niche_overlap_schoener)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6894799</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Warren's I</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>future_niche_overlap_warren <span class="ot">&lt;-</span> <span class="fu">nicheOverlap</span>(species1_future_raster, species2_future_raster, <span class="at">stat =</span> <span class="st">"I"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(future_niche_overlap_warren)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9040432</code></pre>
</div>
</div>
</section>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">Evaluation</h2>
<p>As mentioned previously, the bioclimatic variables selected do not seem to be very good predictors of moose distribution - they are overestimating it. It would therefore be prudent to repeat with other combinations of variables, or to look for other factors which significantly limit the mooses range. The high degree of overlap between cougar and moose ranges is not expected, as cougars are widely-distributed, opportunistic predators which have an extremely varied diet. It would therefore be expected that there would be relatively high dependence in areas in which the two species overlap, but not for the entire range.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Bellani, G. G. (2020). Chapter 5 - Subfamily Felinae. Felines of the World. G. G. Bellani, Academic Press: 145-308.</p>
<p>Jensen, W. F., Smith, J. R., Carstensen, M., Penner, C. E., Hosek, B. M., &amp; Maskey, Jr., J. J. (2018). EXPANDING GIS ANALYSES TO MONITOR AND ASSESS NORTH AMERICAN MOOSE DISTRIBUTION AND DENSITY.&nbsp;<em>Alces</em>,&nbsp;<em>54</em>, 4554. Retrieved from https://alcesjournal.org/index.php/alces/article/view/228</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>